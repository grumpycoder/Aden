"use strict";(function(){function i(i,r){var f="/api/workitem/complete/"+r.id,u;r.isManualUpload&&r.canGenerate?o(i,r):r.actionName==="Review Error"?(u="",u=r.isManual?"Have you resolved the existing errors in the manual file?":"Have you resolved the error generating the file?",BootstrapDialog.confirm({title:"Confirm Error Review",type:BootstrapDialog.TYPE_WARNING,message:'<p class="lead">'+u+'<\/p> <p>Selecting "Ok" will assign a task to begin the process again.<\/p>',callback:function(r){if(r)$toggleWorkingButton(i),$.ajax({url:f,type:"POST",success:function(i){n.refresh();t.refresh();toastr.success("Completed task for "+i.fileName+" ("+i.fileNumber+")")},error:function(n){toastr.error("Error completing task: "+n.responseJSON.message)}}).always(function(){$toggleWorkingButton(i)});else return}})):(console.log("continue with completing task",r),$toggleWorkingButton(i),$.ajax({url:f,type:"POST",success:function(i){n.refresh();t.refresh();toastr.success("Completed task for "+i.fileName+" ("+i.fileNumber+")")},error:function(n){toastr.error("Error completing task: "+n.responseJSON.message)}}).always(function(){$toggleWorkingButton(i)}))}function r(i,r){var u="/api/workitem/reject/"+r.id;BootstrapDialog.confirm("Reject File, are you sure?",function(i){i&&(window.$showModalWorking(),$.ajax({url:u,type:"POST",success:function(i){n.refresh();t.refresh();toastr.warning("Rejected file for "+i.fileName+" ("+i.fileNumber+")")},error:function(){toastr.error("Error rejecting file")}}).always(function(){window.$hideModalWorking()}))})}function u(i,r){var u="/api/workitem/cancel/"+r.id;$toggleWorkingButton(i);$.ajax({url:u,type:"POST",success:function(i){n.refresh();t.refresh();toastr.success("Cancelled task for "+i.fileName+" ("+i.fileNumber+")")},error:function(){toastr.error("Error cancelling task")}}).always(function(){$toggleWorkingButton(i)})}function f(i,r){var u="/home/errorreport/"+r.id,f="/home/reporterror";BootstrapDialog.show({size:window.BootstrapDialog.SIZE_WIDE,draggable:!0,title:"Submission Errors",onshown:function(n){var t=n.getButton(n.getButtons()[1].id);$(document).on("change","#form",function(){console.log("changed");$("#form").validate({rules:{description:{required:!0},errorFiles:{required:!0,fileType:"png"}},messages:{description:{required:"Error description is required"},errorFiles:{required:"Image files are required",fileType:"Wrong file type. Should be png file."}},onfocusout:function(n){this.element(n)}});var n=$("#form");n.valid()?t.enable():t.disable()})},message:$("<div><\/div>").load(u,function(n,t){t==="error"&&toastr.error("Error retrieving reporting errors form")}),buttons:[{label:"Close",action:function(n){n.close()}},{label:"Save",cssClass:"btn-primary",action:function(i){var o,u,e;if(i.enableButtons(!1),i.setClosable(!1),$showModalWorking($(".panel-body")),$("#errorMessage").text(""),o=new FormData($("form")[0]),u=$("#errorFiles")[0].files,u.length>0)for(e=0;e<u.length;e++)o.append("files",u[e]);$.ajax({type:"POST",url:f,data:o,contentType:!1,processData:!1,success:function(){n.refresh();t.refresh();i.close();toastr.success("Saved errors and created task for "+r.fileName+" ("+r.fileNumber+")")},error:function(){toastr.error("Error saving reporting errors for "+r.fileName+" ("+r.fileNumber+")")},complete:function(){i.close()}})}}]})}function e(n,t){var i="/home/workitemimages/"+t.id;BootstrapDialog.show({size:window.BootstrapDialog.SIZE_WIDE,draggable:!0,title:"Error Details",message:$("<div><\/div>").load(i,function(n,t){t==="error"}),buttons:[{label:"Close",action:function(n){n.close()}}]})}function o(i,r){var u="/uploadreport/"+r.id,f="/api/workitem/submitreport/"+r.id;BootstrapDialog.show({size:window.BootstrapDialog.SIZE_WIDE,draggable:!0,title:"File Upload",onshown:function(n){var t=n.getButton(n.getButtons()[1].id);t.disable();$(document).on("change","#form",function(){$("#form").validate({rules:{uploadFiles:{required:!0,fileType:"csv"}},messages:{uploadFiles:{required:"This is required",fileType:"Wrong file type. Should be csv file."}},onfocusout:function(n){this.element(n)}});var n=$("#form");n.valid()?t.enable():t.disable()})},message:$("<div><\/div>").load(u,function(n,t){t==="error"&&toastr.error("Error retrieving reporting errors form")}),buttons:[{label:"Close",action:function(n){n.close()}},{label:"Save",cssClass:"btn-primary",action:function(i){var s,o,u,e;if(i.enableButtons(!1),i.setClosable(!1),$showModalWorking($(".panel-body")),s=this,s.disable(),o=new FormData($("form")[0]),u=$("#uploadFiles")[0].files,u.length>0)for(e=0;e<u.length;e++)o.append("file",u[e]);$.ajax({type:"POST",url:f,data:o,contentType:!1,processData:!1,success:function(){n.refresh();t.refresh();i.close();toastr.success("Saved errors and created task for "+r.fileName+" ("+r.fileNumber+")")},error:function(){toastr.error("Error saving reporting errors for "+r.fileName+" ("+r.fileNumber+")")},complete:function(){i.close()}})}}]})}var n=$("#gridCurrent").dxDataGrid({dataSource:DevExpress.data.AspNet.createStore({key:"id",loadUrl:"/api/workitem"}),remoteOperations:!0,allowColumnResizing:!0,showBorders:!0,scrolling:{mode:"infinite"},paging:{pageSize:20},columnResizingMode:"nextColumn",columnMinWidth:50,columnAutoWidth:!0,wordWrapEnabled:!0,height:300,columns:[{dataField:"displayFileName",caption:"File Name"},{dataField:"dataYear",caption:"Data Year",width:75},{dataField:"assignedDate",caption:"Assigned",dataType:"datetime",width:150},{dataField:"dueDate",caption:"Due",dataType:"datetime",width:150},{width:375,alignment:"center",cellTemplate:function(n,t){t.data.canGenerate||$("<a/>").addClass("btn btn-primary btn-sm btn-grid").text("Review File").attr("href","/review/"+t.data.dataYear+"/"+t.data.fileNumber).attr("aria-label","Review generated file "+t.data.fileName).attr("target","_blank").appendTo(n);var u=t.data.actionName;t.data.isManualUpload&&t.data.canGenerate&&(u="Upload");$("<a/>").addClass("btn btn-success btn-sm btn-grid").text(u).attr("aria-label",t.data.actionName+" "+t.data.fileName).on("dxclick",function(){i($(this),t.data)}).appendTo(n);t.data.canReject&&$("<a/>").addClass("btn btn-danger btn-sm btn-grid").text("Reject File").attr("aria-label","Reject generated file "+t.data.fileName).on("dxclick",function(){r($(this),t.data)}).appendTo(n);t.data.canSubmit&&$("<a/>").addClass("btn btn-danger btn-sm btn-grid").text("Report Errors").attr("aria-label","Confirm file submitted "+t.data.fileName).on("dxclick",function(){f($(this),t.data)}).appendTo(n);t.data.canReviewError&&$("<a/>").addClass("btn btn-danger btn-sm btn-grid").text("View Errors").attr("aria-label","Review submission errors "+t.data.fileName).on("dxclick",function(){e($(this),t.data)}).appendTo(n)}}],onToolbarPreparing:function(n){var t=n.component;n.toolbarOptions.items.unshift({location:"after",widget:"dxButton",options:{icon:"refresh",hint:"Refresh",onClick:function(){t.refresh()}}})}}).dxDataGrid("instance"),t=$("#gridComplete").dxDataGrid({dataSource:DevExpress.data.AspNet.createStore({key:"id",loadUrl:"/api/workitem/finished"}),remoteOperations:!0,allowColumnResizing:!0,showBorders:!0,scrolling:{mode:"infinite"},paging:{pageSize:20},columnResizingMode:"nextColumn",columnMinWidth:50,columnAutoWidth:!0,wordWrapEnabled:!0,height:300,columns:[{dataField:"displayFileName",caption:"File Name"},{dataField:"dataYear",caption:"Data Year"},{dataField:"assignedDate",caption:"Assigned",dataType:"datetime"},{dataField:"completedDate",caption:"Completed",dataType:"datetime"},{dataField:"actionName",caption:"Action"},{width:150,alignment:"center",cellTemplate:function(n,t){t.data.canCancel&&$("<a/>").addClass("btn btn-default btn-sm btn-grid").text("Cancel").on("dxclick",function(){u($(this),t.data)}).appendTo(n)}}],onToolbarPreparing:function(n){var t=n.component;n.toolbarOptions.items.unshift({location:"after",widget:"dxButton",options:{icon:"refresh",hint:"Refresh",onClick:function(){t.refresh()}}})}}).dxDataGrid("instance")})();$.validator.addMethod("fileType",function(n,t,i){return n.split(".")[1].toLowerCase()===i.toLowerCase()},"Invalid file type");jQuery.validator.addMethod("myRule",function(n,t,i){return n===i.data},"My Rule says no!");