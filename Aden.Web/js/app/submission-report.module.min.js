"use strict";$(function(){function l(t){var i="Submission History - ["+t.row.data.fileName+"]",r="/history/"+t.row.data.id;BootstrapDialog.show({size:window.BootstrapDialog.SIZE_WIDE,draggable:!0,closable:!1,title:i,message:$("<div><\/div>").load(r,function(n,t){t==="error"&&toastr.error("Error retrieving history")}),buttons:[{label:"Close",action:function(t){window.assignmentUpdated===!0&&(n.refresh(),window.assignmentUpdated=!1);t.close()}}]})}function a(n,t){var i=["active","success","info","warning","danger"],r=window.moment();if(t.submissionStateDisplay==="Completed"||t.submissionStateDisplay==="Waived"){n.addClass(i[1]);return}if(t.submissionStateDisplay==="CompleteWithErrors"){n.addClass(i[2]);return}if(t.submissionStateDisplay!=="Completed"&&r.isSameOrAfter(t.dueDate)){n.addClass(i[4]);return}if(t.submissionStateDisplay!=="Completed"&&r.add(14,"days").isSameOrAfter(t.dueDate)){n.addClass(i[3]);return}}function v(){$("#btnStatusFilter button").siblings().removeClass("active");$("#btnGroupDue button").siblings().removeClass("active");$("#btnSupportGroup button").siblings().removeClass("active")}function i(n){$("#"+n+" button").siblings().removeClass("active")}function s(i){if(u=[],n.deleteColumn("lastUpdatedFriendly"),n.deleteColumn("submissionDate"),i===undefined){t=u;r();return}var f=moment().add(0,"days").format();i==="Completed"&&(n.addColumn({dataField:"submissionDate",caption:"Date Submitted",visibleIndex:17}),u.push(["submissionStateDisplay","=","Completed"],"or",["submissionStateDisplay","=","Waived"]));i==="Overdue"&&(n.addColumn({dataField:"lastUpdatedFriendly",caption:"Last Update",visibleIndex:17}),u.push(["deadlineDate","<",f],["submissionStateDisplay","<>","Completed"],["submissionStateDisplay","<>","Waived"]));t=u;r()}function h(n){if(f=[],n===undefined){t=f;r();return}var i=[],u=moment().add(0,"days").format(),e=moment().add(n,"days").format();i.push(["deadlineDate",">=",u]);i.push("and");i.push(["deadlineDate","<=",e]);i.push(["submissionStateDisplay","<>","Completed"]);i.push(["submissionStateDisplay","<>","Waived"]);f.push(i);t=f;r()}function c(n){if(e=[],n===undefined){t=e;r();return}e.push(["supportGroup","=",n]);t=e;r()}function r(){n.clearFilter();n.filter(t)}var o,n;console.log("submission report view ready");window.assignmentUpdated=!1;o="/api/submission";n=$("#gridReport").dxDataGrid({dataSource:DevExpress.data.AspNet.createStore({key:"id",loadUrl:o,updateUrl:o}),remoteOperations:!0,allowColumnResizing:!0,allowColumnReordering:!0,showBorders:!0,wordWrapEnabled:!0,"export":{enabled:!0,fileName:"Submissions",allowExportSelectedData:!1,icon:"fa fa-trash"},filterRow:{visible:!0},headerFilter:{visible:!0},groupPanel:{visible:!1},scrolling:{mode:"virtual",rowRenderingMode:"virtual"},paging:{pageSize:20},height:650,columnResizingMode:"nextColumn",columnMinWidth:50,columnAutoWidth:!0,columnChooser:{enabled:!0},columns:[{width:50,type:"buttons",buttons:["edit","delete",{text:"History",icon:"fa fa-history",hint:"History",onClick:function(n){l(n)}}]},{dataField:"fileNumber",caption:"File Number",visibleIndex:1},{dataField:"fileName",caption:"File Name",visibleIndex:2},{dataField:"deadlineDate",caption:"Submission Deadline",dataType:"date",visibleIndex:6},{dataField:"displayDataYear",caption:"Data Year",visibleIndex:7},{dataField:"section",caption:"Section",visibleIndex:8},{dataField:"submissionStateDisplay",caption:"Status",visibleIndex:9},{dataField:"currentAssignment",caption:"Assigned",visibleIndex:10},{dataField:"application",caption:"Application",visibleIndex:14},{dataField:"supportGroup",caption:"Support Group",visibleIndex:15},{dataField:"collection",caption:"Collection",visibleIndex:16},{dataField:"submissionDate",caption:"Date Submitted",dataType:"date",visible:!1},{dataField:"lastUpdatedFriendly",caption:"Last Update",visible:!1},{dataField:"isSEA",caption:"SEA",dataType:"boolean",visible:!0,visibleIndex:3,showEditorAlways:!1,trueText:"Yes",falseText:"No",customizeText:function(n){return n.value?"Yes":"No"}},{dataField:"isLEA",caption:"LEA",dataType:"boolean",visible:!0,visibleIndex:4,showEditorAlways:!1,trueText:"Yes",falseText:"No",customizeText:function(n){return n.value?"Yes":"No"}},{dataField:"isSCH",caption:"SCH",dataType:"boolean",visible:!0,visibleIndex:5,showEditorAlways:!1,trueText:"Yes",falseText:"No",customizeText:function(n){return n.value?"Yes":"No"}},{dataField:"generators",caption:"Generators",dataType:"string",visible:!0,visibleIndex:11,cellTemplate:function(n,t){t.data.generators.forEach(function(t){$("<span>"+t+"<\/span><br />").appendTo(n)})},allowFiltering:!1,calculateDisplayValue:function(n){return n.generators.join(", ")}},{dataField:"approvers",caption:"Approvers",dataType:"string",visible:!0,visibleIndex:12,cellTemplate:function(n,t){t.data.approvers.forEach(function(t){$("<span>"+t+"<\/span><br />").appendTo(n)})},allowFiltering:!1,calculateDisplayValue:function(n){return n.approvers.join(", ")}},{dataField:"submitters",caption:"Submitters",dataType:"string",visible:!1,cellTemplate:function(n,t){t.data.submitters.forEach(function(t){$("<span>"+t+"<\/span><br />").appendTo(n)})},allowFiltering:!1,calculateDisplayValue:function(n){return n.submitters.join(", ")}},{width:200,alignment:"center",cellTemplate:function(n,t){t.data.canReview&&$("<a/>").addClass("btn btn-default btn-sm btn-grid").text("Review File").attr("aria-label","Review submission report file").attr("href","/review/"+t.data.dataYear+"/"+t.data.fileNumber).attr("target","_blank").appendTo(n)}}],sortByGroupSummaryInfo:[{summaryItem:"count"}],summary:{totalItems:[{column:"fileNumber",displayFormat:"{0} Submissions",summaryType:"count",showInGroupFooter:!0,showInColumn:"FileNumber"}],groupItems:[{summaryType:"count",displayFormat:"{0} Submissions"}]},onRowPrepared:function(n){n.rowType==="data"&&a(n.rowElement,n.data)},onContentReady:function(){$(".dx-datagrid-table").addClass("table")},onToolbarPreparing:function(n){var t=n.component;n.toolbarOptions.items.unshift({location:"after",widget:"dxButton",options:{icon:"refresh",hint:"Refresh",onClick:function(){t.refresh()}}},{location:"after",widget:"dxButton",options:{icon:"clearformat",hint:"Clear filters",onClick:function(){t.clearFilter();v()}}})}}).dxDataGrid("instance");$("#btnStatusFilter button").on("click",function(){var n=$(this);i("btnGroupDue");i("btnSupportGroup");n.hasClass("active")?(n.removeClass("active"),s()):(n.addClass("active").siblings().removeClass("active"),s(n.val()))});$("#btnGroupDue button").on("click",function(){var n=$(this);i("btnStatusFilter");i("btnSupportGroup");n.hasClass("active")?(n.removeClass("active"),h()):(n.addClass("active").siblings().removeClass("active"),h(n.val()))});$("#btnSupportGroup button").on("click",function(){var n=$(this);i("btnStatusFilter");i("btnGroupDue");n.hasClass("active")?(n.removeClass("active"),c()):(n.addClass("active").siblings().removeClass("active"),c(n.val()))});var t=[],u=[],f=[],e=[]});